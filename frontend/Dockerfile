FROM node:22-slim AS builder
LABEL com.centurylinklabs.watchtower.enable="true"

WORKDIR /app


COPY package.json yarn.lock ./

RUN yarn install

COPY . .

ENV NEXT_PUBLIC_BACKEND_URI=https://api.zk-loans.aichallenge.fun
ENV NEXT_PUBLIC_DYNAMIC_ENV_ID=f7582e95-eb3d-4beb-bff1-6e94004f0000



ENV NEXT_PUBLIC_BACKEND_URI="https://api.zk-loans.aichallenge.fun"
ENV NEXT_PUBLIC_GOOGLE_REDIRECT_URI="https://zk-loans.aichallenge.fun/email"
ENV NEXT_PUBLIC_DYNAMIC_ENV_ID="7c0129ea-c276-419f-a158-a5ba44df52a3"

ARG NEXT_PUBLIC_OPENAI_API_KEY
ARG NEXT_PUBLIC_GOOGLE_CLIENT_ID
ARG NEXT_PUBLIC_GOOGLE_CLIENT_SECRET
ARG NEXT_PUBLIC_VLAYER_API_TOKEN
ENV NEXT_PUBLIC_OPENAI_API_KEY=${NEXT_PUBLIC_OPENAI_API_KEY}
ENV NEXT_PUBLIC_GOOGLE_CLIENT_ID=${NEXT_PUBLIC_GOOGLE_CLIENT_ID}
ENV NEXT_PUBLIC_GOOGLE_CLIENT_SECRET=${NEXT_PUBLIC_GOOGLE_CLIENT_SECRET}
ENV NEXT_PUBLIC_VLAYER_API_TOKEN=${NEXT_PUBLIC_VLAYER_API_TOKEN}

ENV USDC_ETH_SEPOLIA="0xE69711C55f6E87F4c39321D3aDeCc4C2CAddc471"
ENV USDC_OPTIMISM_SEPOLIA="0x92A08a34488Fcc8772Af2269186e015Eca494Baa"
ENV USDC_BASE_SEPOLIA="0x7B4707070b8851F82B5339aaC7F6759d8e737E88"

ENV NEXT_PUBLIC_VLAYER_PROVER_URL="https://stable-fake-prover.vlayer.xyz"

ENV NEXT_PUBLIC_TIMETRAVEL_PROVER_ADDRESS="0x51fb4ab6b17bd7f5a18f031369da638ce7b19e30"
ENV NEXT_PUBLIC_TIMETRAVEL_VERIFIER_ADDRESS="0x967e74ef3572ea6f8ae0bc3309227945613ad239"

ENV NEXT_PUBLIC_TELEPORTER_PROVER_ADDRESS="0x438cb7d7e09a3cf573315d74afacecc53266d713"
ENV NEXT_PUBLIC_TELEPORTER_VERIFIER_ADDRESS="0x9ad75d90e0bdb6089fbf849e722367fd5068d915"

ENV NEXT_PUBLIC_EMAIL_PROVER_ADDRESS="0x9134a21cb76745cf03e110be834b83e651b39904"
ENV NEXT_PUBLIC_EMAIL_VERIFIER_ADDRESS="0xc647ec40d2937dbf9e3ff8486dd7531af6faa3f4"

ENV NEXT_PUBLIC_ROOTSTOCK_LENDING_ADDRESS="0x31e0A37bda916C0098be8600e6f156D877cb4BA8"
ENV NEXT_PUBLIC_ETH_SEPOLIA_SCORING_ADDRESS="0xFbC66bD8466f7B7628fD32F8a8C07f3976c73979"

# Build del frontend
RUN yarn build

# ---------- Runner ----------
FROM node:22-slim

WORKDIR /app

RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*


COPY --from=builder /app/package.json ./
COPY --from=builder /app/yarn.lock ./
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/next.config.ts ./next.config.ts

EXPOSE 4500

CMD ["yarn", "start", "--port", "4500", "--hostname", "0.0.0.0"]